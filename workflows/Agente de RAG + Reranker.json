{
  "active": false,
  "connections": {
    "When clicking ‘Execute workflow’": {
      "main": [
        [
          {
            "node": "Get a document",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Recursive Character Text Splitter": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Get a document": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders": {
      "main": [
        [
          {
            "node": "Get a document",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-07-11T05:09:44.358Z",
  "id": "oJPb7BEDZz16etjR",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Agente de RAG + Reranker",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -1520,
        -144
      ],
      "id": "6723f7ca-6758-4279-b1c6-49493cfb9c2f",
      "name": "When clicking ‘Execute workflow’"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        -160,
        64
      ],
      "id": "f4eaeb4c-5c4e-4ed2-aec3-1eed5f364644",
      "name": "Embeddings OpenAI1",
      "credentials": {
        "openAiApi": {
          "id": "QzQb6Q9G3hGozb9v",
          "name": "OpenAi - Dani 2"
        }
      }
    },
    {
      "parameters": {
        "jsonMode": "expressionData",
        "jsonData": "={{ $('Loop Over Items').item.json.content }}",
        "textSplittingMode": "custom",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "Duvidas sobre",
                "value": "pagamentos/futuras aulas/troca de email/acesso aocurso"
              }
            ]
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        64,
        64
      ],
      "id": "85fcea0d-5db5-4f86-ab33-0c77070cd192",
      "name": "Default Data Loader"
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": {
          "__rl": true,
          "value": "curso",
          "mode": "list",
          "cachedResultName": "curso"
        },
        "options": {
          "queryName": "match_curso"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        -64,
        -176
      ],
      "id": "d0a17703-37ee-44c9-b416-c2bc49374ece",
      "name": "Supabase Vector Store",
      "credentials": {
        "supabaseApi": {
          "id": "QiHN5zEBNyZ0P663",
          "name": "Supabase - Sorveteiro Raiz"
        }
      }
    },
    {
      "parameters": {
        "content": "## VETORIZADOR",
        "height": 748,
        "width": 2244,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1616,
        -368
      ],
      "typeVersion": 1,
      "id": "cc2296db-43c5-44d8-aa95-f05a11d86d19",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "chunkSize": 26000,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        208,
        192
      ],
      "id": "d72c7c8e-3d55-48c9-8ba1-3768542f2f2c",
      "name": "Recursive Character Text Splitter"
    },
    {
      "parameters": {
        "operation": "get",
        "documentURL": "=1lKrcHcRAuHWVcpyaa9cXfSySKwUqv5usTgneDquv0uA"
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        -1104,
        -112
      ],
      "id": "31fb455f-091e-432a-8e2e-f7a60cf6fdcb",
      "name": "Get a document",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "7TJ0i7jDnGNCXmQR",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -608,
        -144
      ],
      "id": "147839dc-4d41-43da-9165-ccb24437a8c3",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        288,
        -176
      ],
      "id": "be0184aa-677c-4734-b6af-6a824fe3331c",
      "name": "Wait",
      "webhookId": "eb2139c1-1fc3-4aa3-8b0a-d7462a11c68d",
      "disabled": true
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "returnAll": true,
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "1p8mhaYapN1hgI0s0EFBXMXQiNEx2i-a_",
            "mode": "list",
            "cachedResultName": "Modulo 6",
            "cachedResultUrl": "https://drive.google.com/drive/folders/1p8mhaYapN1hgI0s0EFBXMXQiNEx2i-a_"
          }
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -1296,
        -368
      ],
      "id": "72d21ade-41a8-47f6-bdcf-1fba303ede35",
      "name": "Search files and folders",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "Fj0pGWTsgTW5yLNC",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "03a9bb27-f540-44e7-8c2a-98a996676128",
              "name": "content",
              "value": "={{ $json.texto_original }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -368,
        -128
      ],
      "id": "9b066bd6-612c-46ae-8e04-96eee03fc678",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "jsCode": "// Acessa o conteúdo\nlet content;\ntry {\n  if ($input.all && $input.all().length > 0) {\n    content = $input.all()[0].json.content;\n  } else if ($input.item && $input.item.json) {\n    content = $input.item.json.content;\n  }\n} catch (e) {\n  throw new Error('Erro ao acessar conteúdo');\n}\n\nif (!content) {\n  throw new Error('Conteúdo não encontrado');\n}\n\n// Categorias/motivos de cada pergunta\nconst categorias = {\n  \"Quero fazer sorvete apenas para consumo próprio\": \"Qualificação de Lead - Intenção de Uso\",\n  \"Não tenho maquinários\": \"Objeção Estrutural - Equipamentos\",\n  \"Faço geladinho gourmet. Isso serve\": \"Qualificação de Lead - Produto Relacionado\",\n  \"Já trabalho com sorvete/açaí\": \"Objeção Técnica - Qualidade do Produto\",\n  \"Tenho experiência, mas quero melhorar\": \"Qualificação Positiva - Aperfeiçoamento\",\n  \"Tenho dificuldade com receitas\": \"Objeção Técnica - Desenvolvimento de Receitas\",\n  \"Já sei fazer sorvete, quero só aprender a balancear\": \"Qualificação Positiva - Conhecimento Específico\",\n  \"Quanto tempo tenho de acesso\": \"Objeção Estrutural - Acesso e Suporte\",\n  \"O curso é atualizado\": \"Objeção de Valor - Atualização de Conteúdo\",\n  \"E se eu tiver dúvidas\": \"Objeção Estrutural - Suporte\",\n  \"Eu ainda não tenho nenhuma máquina\": \"Objeção Estrutural - Equipamentos Inicial\",\n  \"Na verdade, eu só queria aprender a fazer pra família\": \"Qualificação de Lead - Uso Doméstico\",\n  \"Eu já tenho minha loja\": \"Objeção Técnica - Negócio Estabelecido\",\n  \"Eu já entendo de sorvete\": \"Qualificação Positiva - Especialização\",\n  \"Eu faço geladinho gourmet, esse curso serve\": \"Qualificação de Lead - Transição de Produto\",\n  \"Eu tô com medo\": \"Objeção Psicológica - Insegurança\",\n  \"No curso indica maquinário\": \"Dúvida sobre Conteúdo - Equipamentos\",\n  \"No curso tem receitas\": \"Dúvida sobre Conteúdo - Receitas\",\n  \"Vocês vendem somente\": \"Objeção Comercial - Produto Separado\",\n  \"Não tenho dinheiro\": \"Objeção Comercial - Investimento\",\n  \"Vou deixar para a próxima\": \"Objeção de Urgência - Procrastinação\",\n  \"Eu já produzo em escala\": \"Qualificação Positiva - Produção Industrial\",\n  \"Não sei se vou conseguir acompanhar\": \"Objeção Estrutural - Tempo Disponível\",\n  \"E se eu não gostar\": \"Objeção de Risco - Garantia\"\n};\n\n// Função para encontrar o motivo\nfunction encontrarMotivo(pergunta) {\n  for (const [key, value] of Object.entries(categorias)) {\n    if (pergunta.toLowerCase().includes(key.toLowerCase())) {\n      return value;\n    }\n  }\n  return \"Objeção Geral\";\n}\n\n// Regex para capturar pergunta e resposta\n// Captura: \"pergunta\"\\nResposta: resposta (até a próxima pergunta ou fim)\nconst regex = /\"([^\"]+)\"\\s*\\n\\s*Resposta:\\s*([^\"]+?)(?=\\n\"|$)/gs;\n\nconst results = [];\nlet match;\n\nwhile ((match = regex.exec(content)) !== null) {\n  const pergunta = match[1].trim();\n  const resposta = match[2].trim();\n  \n  const motivo = encontrarMotivo(pergunta);\n  \n  results.push({\n    pergunta: pergunta,\n    resposta: resposta,\n    texto_completo: `\"${pergunta}\"\\n\\nResposta: ${resposta}`,\n    motivo: motivo,\n    categoria_principal: motivo.split(' - ')[0],\n    subcategoria: motivo.split(' - ')[1] || 'Geral'\n  });\n}\n\n// Log para debug\nconsole.log(`Total de perguntas encontradas: ${results.length}`);\n\nreturn results.map(item => ({ json: item }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -848,
        -144
      ],
      "id": "865989c9-2deb-4cf1-a99f-684341baedae",
      "name": "Code",
      "disabled": true
    },
    {
      "parameters": {
        "content": "```\n$$$$$$\\   $$\\   $$\\ $$$$$$$\\   $$$$$$\\  $$$$$$$\\$$$$$$$$\\ $$$$$$$$\\ \n$$  __$$\\ $$ |  $$ |$$  __$$\\ $$  __$$\\ $$  __$$\\\\__$$  __|$$  _____|\n$$ /  \\__|$$ |  $$ |$$ |  $$ |$$ /  $$ |$$ |  $$ |  $$ |   $$ |      \n\\$$$$$$\\  $$ |  $$ |$$$$$$$  |$$ |  $$ |$$$$$$$  |  $$ |   $$$$$\\    \n \\____$$\\ $$ |  $$ |$$  ____/ $$ |  $$ |$$  __$$    $$ |   $$  __|   \n$$\\   $$ |$$ |  $$ |$$ |      $$ |  $$ |$$ |  $$ |  $$ |   $$ |      \n\\$$$$$$  |\\$$$$$$  |$$ |      \\$$$$$$  |$$ |  $$ |  $$ |   $$$$$$$$\\ \n \\______/  \\______/ \\__|       \\______/ \\__|  \\__|  \\__|   \\________|\n```",
        "height": 180,
        "width": 680,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -896,
        -608
      ],
      "typeVersion": 1,
      "id": "55ffb3c8-bf92-4043-864d-73a1e6777e44",
      "name": "Sticky Note"
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "createdAt": "2025-07-11T05:09:44.358Z",
      "updatedAt": "2025-07-11T05:09:44.358Z",
      "role": "workflow:owner",
      "workflowId": "oJPb7BEDZz16etjR",
      "projectId": "MnGFQuvoDMTHLtMd"
    }
  ],
  "staticData": null,
  "tags": [
    {
      "createdAt": "2025-07-11T05:08:17.050Z",
      "updatedAt": "2025-07-11T05:08:17.050Z",
      "id": "at11ZIwIDccBfgnS",
      "name": "Youtube"
    },
    {
      "createdAt": "2025-07-11T05:08:17.035Z",
      "updatedAt": "2025-07-11T05:08:17.035Z",
      "id": "MjlWgQ1bNOy1eHbS",
      "name": "Anderson Adelino"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2026-01-21T12:43:14.807Z",
  "versionId": "72e883ab-488f-4a52-86e6-34c9291e9d0f"
}