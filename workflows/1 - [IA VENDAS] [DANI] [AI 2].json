{
  "active": true,
  "connections": {
    "Switch2": {
      "main": [
        [
          {
            "node": "Get Base64 Audio",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Add na Memória",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "espera evolution processar imagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OutputParser": {
      "ai_outputParser": [
        [
          {
            "node": "Parser  Chain1",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Replace Me1": {
      "main": [
        [
          {
            "node": "Responde texto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Responde texto": {
      "main": [
        [
          {
            "node": "1,2s",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parser  Chain1": {
      "main": [
        [
          {
            "node": "Segmentos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "no.op2": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [
          {
            "node": "Supabase",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Replace Me1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "1,2s": {
      "main": [
        [
          {
            "node": "no.op2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Segmentos": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI2": {
      "ai_languageModel": [
        [
          {
            "node": "Parser  Chain1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "fromMe": {
      "main": [
        [
          {
            "node": "NOP1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Atualiza_follow_up",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CreateUser": {
      "main": [
        [
          {
            "node": "Cria contato follow_up",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "fromMe",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "GeraUUID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "getClient": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "camposIniciais": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "messages": {
      "main": [
        [
          {
            "node": "Vendedor IA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Vendedor IA": {
      "main": [
        [
          {
            "node": "Parser  Chain1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "transcreve audio2": {
      "main": [
        [
          {
            "node": "Add Áudio no Buffer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "getContexto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "getContexto": {
      "main": [
        [
          {
            "node": "Oferta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GeraUUID": {
      "main": [
        [
          {
            "node": "CreateUser",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prompt_": {
      "main": [
        [
          {
            "node": "getClient",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase": {
      "main": [
        [
          {
            "node": "Redis2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "camposIniciais",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "converte imagem": {
      "main": [
        [
          {
            "node": "transcreve imagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "transcreve imagem": {
      "main": [
        [
          {
            "node": "empilhaÁudio1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "espera evolution processar imagem": {
      "main": [
        [
          {
            "node": "Busca imagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Busca imagem": {
      "main": [
        [
          {
            "node": "converte imagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "empilhaÁudio1": {
      "main": [
        [
          {
            "node": "Memória Inicial",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "searchProduto",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Reranker Cohere": {
      "ai_reranker": [
        [
          {
            "node": "searchProduto",
            "type": "ai_reranker",
            "index": 0
          }
        ]
      ]
    },
    "searchProduto": {
      "ai_tool": [
        [
          {
            "node": "Vendedor IA",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Oferta": {
      "main": [
        [
          {
            "node": "Prompt_",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Base64 Audio": {
      "main": [
        [
          {
            "node": "Get Audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Audio": {
      "main": [
        [
          {
            "node": "transcreve audio2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add na Memória": {
      "main": [
        [
          {
            "node": "Memória Inicial",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Espere": {
      "main": [
        [
          {
            "node": "Memória Final",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Memória Inicial": {
      "main": [
        [
          {
            "node": "Espere",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Memória Final": {
      "main": [
        [
          {
            "node": "Concatena Mensagens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Concatena Mensagens": {
      "main": [
        [
          {
            "node": "Compara Memórias",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Compara Memórias": {
      "main": [
        [
          {
            "node": "Limpar Memória",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limpar Memória": {
      "main": [
        [
          {
            "node": "UserMessage",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add Áudio no Buffer": {
      "main": [
        [
          {
            "node": "Memória Inicial",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UserMessage": {
      "main": [
        [
          {
            "node": "messages",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cria contato follow_up": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Atualiza_follow_up": {
      "main": [
        [
          {
            "node": "Switch2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "searchcurso",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Reranker Cohere1": {
      "ai_reranker": [
        [
          {
            "node": "searchcurso",
            "type": "ai_reranker",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI2": {
      "ai_embedding": [
        [
          {
            "node": "searchobjecoes",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Reranker Cohere2": {
      "ai_reranker": [
        [
          {
            "node": "searchobjecoes",
            "type": "ai_reranker",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI3": {
      "ai_embedding": [
        [
          {
            "node": "searchprovasocial",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Reranker Cohere3": {
      "ai_reranker": [
        [
          {
            "node": "searchprovasocial",
            "type": "ai_reranker",
            "index": 0
          }
        ]
      ]
    },
    "searchobjecoes": {
      "ai_tool": [
        [
          {
            "node": "Vendedor IA",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Memoria": {
      "ai_memory": [
        [
          {
            "node": "Vendedor IA",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Modelo IA": {
      "ai_languageModel": [
        [
          {
            "node": "Vendedor IA",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "getClient",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "searchcurso": {
      "ai_tool": [
        []
      ]
    }
  },
  "createdAt": "2025-06-14T17:42:51.743Z",
  "id": "B5pfDl16X8v0pxhq",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "1 - [IA VENDAS] [DANI] [AI 2]",
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "=Whatsapp message to be splitted and formated: {{ $json.output }}",
        "hasOutputParser": true,
        "messages": {
          "messageValues": [
            {
              "message": "=Por favor, gere a saída no seguinte formato JSON:\n{\n  \"messages\": [\n    \"splitedMessage\",\n    \"splitedMessage\",\n    \"splitedMessage\"\n  ]\n}\n\nAs mensagens devem ser divididas de forma natural, afinal estamos conversando com um humano, não é mesmo?\n\n### Jamais separe uma mensagem vazia.\n\n### Certifique-se de que a resposta siga exatamente essa estrutura abaixo, deixando somente entre '*' para negrito e nunca fugindo das demais regras de markdown do WhatsApp:\n\t\t\t- *negrito* (substitua '**' por '*')\n\t\t\t- _itálico_ (extremamente raro)\n            - `link` (usar sempre em todos os links)\n\nTudo o que for link, deve ser exibido limpo e direto, **sem texto descritivo ou âncoras**, usando somente o domínio puro como: `https://link.com.br/exemplo`\n\n❗ Nunca use markdown no estilo `[texto](link)` ou `Texto (link)`, apenas o link puro.\n\nSe detectar um link com o padrão como por exemplo `https://lp.sorveteiroraiz.com/curso-profissao-sorveteiro-pg-ia-vendas`, corrija automaticamente para `lp.sorveteiroraiz.com/curso-profissao-sorveteiro-pg-ia-vendas`, pois o domínio com www não funciona."
            }
          ]
        }
      },
      "id": "79b69fdd-938d-4b2e-aed9-61caec501b6c",
      "name": "Parser  Chain1",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.4,
      "position": [
        2540,
        1460
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "dani-aivendas-01",
        "options": {}
      },
      "id": "a57b0561-e905-4eab-bd14-f0cf6b869138",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -4260,
        1660
      ],
      "webhookId": "01b980a0-8dbe-4b4d-8857-2321c4c5875b"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('camposIniciais').item.json.whatsapp.evo.server_url }}/message/sendText/{{ $('camposIniciais').item.json.whatsapp.evo.nomeInstancia }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $('camposIniciais').item.json.whatsapp.evo.apikey }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $('camposIniciais').item.json.meta.telefoneCliente }}"
            },
            {
              "name": "text",
              "value": "={{ $json.output }}"
            },
            {
              "name": "linkPreview",
              "value": "={{ $('camposIniciais').item.json.linkPreview }}"
            },
            {
              "name": "delay",
              "value": "={{ $('camposIniciais').item.json.Digitando }}"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "95e012b7-7370-481c-b224-442681456eb0",
      "name": "Responde texto",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3520,
        1540
      ],
      "retryOnFail": true,
      "waitBetweenTries": 5000
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Webhook').item.json.body.data.messageType }}",
                    "rightValue": "audioMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Áudio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "0cb14635-2673-408e-86db-ce9e0373674b",
                    "leftValue": "={{ $('Webhook').item.json.body.data.messageType }}",
                    "rightValue": "conversation",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Texto"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "60065893-74f7-4b64-bc1a-d891202efa78",
                    "leftValue": "={{ $('Webhook').item.json.body.data.messageType }}",
                    "rightValue": "imageMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Imagem"
            }
          ]
        },
        "options": {}
      },
      "id": "9d8374a0-822a-4fe2-8878-10a2e77f67c1",
      "name": "Switch2",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -1200,
        1620
      ]
    },
    {
      "parameters": {
        "content": "## PASSO 5 - ORGANIZA E ENVIA AS MENSAGENS PARA O CLIENTE",
        "height": 674,
        "width": 1684,
        "color": 6
      },
      "id": "eff4eecc-de9b-415f-b6fe-e6d007863422",
      "name": "Sticky Note11",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2440,
        1160
      ]
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"messages\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"string\"\n      }\n    }\n  },\n  \"required\": [\"messages\"]\n}"
      },
      "id": "939c8682-b148-4cad-b3e4-f7b332846a2c",
      "name": "OutputParser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        2720,
        1680
      ]
    },
    {
      "parameters": {},
      "id": "d7760b64-088a-4c41-8f90-bbc8cffe2550",
      "name": "Replace Me1",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        3320,
        1540
      ]
    },
    {
      "parameters": {},
      "id": "033c2809-dc8c-4046-8851-f1943ef64e2a",
      "name": "no.op2",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        3920,
        1540
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "eac023cd-d2e9-4f75-b5d4-af9f46654aba",
      "name": "Loop Over Items1",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        3100,
        1460
      ]
    },
    {
      "parameters": {
        "amount": 1.2
      },
      "id": "c6d88a35-4671-430c-a9f5-d720896bd599",
      "name": "1,2s",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        3720,
        1540
      ],
      "webhookId": "e5987401-8b77-4a84-8693-25fd8898cd94"
    },
    {
      "parameters": {
        "fieldToSplitOut": "output.messages",
        "options": {
          "destinationFieldName": "output"
        }
      },
      "id": "5c6c7ea7-016b-49b1-8f18-24f666def5f5",
      "name": "Segmentos",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        2900,
        1460
      ]
    },
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {}
      },
      "id": "3a309e95-43b3-4a40-9fab-cae02edf3a24",
      "name": "OpenAI2",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        2500,
        1660
      ],
      "credentials": {
        "openAiApi": {
          "id": "QzQb6Q9G3hGozb9v",
          "name": "OpenAi - Dani 2"
        }
      }
    },
    {
      "parameters": {
        "content": "## PASSO 4 - AGENTE DE IA COM INTELIGÊNCIA E TOOLS",
        "height": 414,
        "width": 1039,
        "color": 6
      },
      "id": "13855d30-e9e3-4869-a730-54346219f738",
      "name": "Sticky Note9",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1100,
        1200
      ]
    },
    {
      "parameters": {
        "content": "## PASSO 2 - CRIA USUÁRIO NO BANCO DE DADOS SUPABASE",
        "height": 830,
        "width": 1099,
        "color": 6
      },
      "id": "3523914a-159e-4cd2-864b-eab005d64e68",
      "name": "Sticky Note8",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -2440,
        1240
      ]
    },
    {
      "parameters": {
        "content": "## PASSO 1 - CREDENCIAIS, DADOS, E PROMPT AGENTE",
        "height": 614,
        "width": 1819,
        "color": 6
      },
      "id": "901eefc1-174a-437c-9f20-a1e9a8f9ea2f",
      "name": "Sticky Note6",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -4400,
        1320
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "b3c9b986-29a6-4418-a033-6422c387377f",
              "leftValue": "={{ $node[\"Webhook\"].json[\"body\"][\"data\"][\"key\"][\"fromMe\"] }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "5707b485-ac08-4f4c-a1b8-5ef70175f752",
      "name": "fromMe",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2000,
        1540
      ]
    },
    {
      "parameters": {},
      "id": "8e677444-fd08-499a-b2bd-b95ed58494f2",
      "name": "NOP1",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -1720,
        1440
      ]
    },
    {
      "parameters": {
        "tableId": "atendimento_wpp_vendas",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "nome",
              "fieldValue": "={{ $('camposIniciais').item.json.meta.nomeCliente }}"
            },
            {
              "fieldId": "telefone",
              "fieldValue": "={{ $item(\"0\").$node[\"Code\"].json[\"telefoneCliente\"] }}"
            },
            {
              "fieldId": "idmensagem",
              "fieldValue": "={{ $('camposIniciais').item.json.content.idMensagem }}"
            },
            {
              "fieldId": "sessionid",
              "fieldValue": "={{ $json.data }}"
            }
          ]
        }
      },
      "id": "7906ba09-f631-469e-8cf4-2b48da6bd451",
      "name": "CreateUser",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1840,
        1820
      ],
      "credentials": {
        "supabaseApi": {
          "id": "QiHN5zEBNyZ0P663",
          "name": "Supabase - Sorveteiro Raiz"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4e77cc7c-48f4-4cbe-94e7-6d211db67002",
              "leftValue": "={{ $('getClient').item.json.telefone }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "903d0451-b2f4-493f-9902-88dcf3b56655",
      "name": "If1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2160,
        1660
      ]
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "atendimento_wpp_vendas",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "keyValue": "={{ $item(\"0\").$node[\"Code\"].json[\"telefoneCliente\"] }}"
            }
          ]
        }
      },
      "id": "990a13a4-f6c8-4442-95b1-bb2a7d3c407d",
      "name": "getClient",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -2360,
        1660
      ],
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "QiHN5zEBNyZ0P663",
          "name": "Supabase - Sorveteiro Raiz"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f9ecf2fc-da2c-4f44-897a-5dc0a2f2f379",
              "name": "meta.telefoneCliente",
              "value": "={{ $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"data\"][\"key\"][\"remoteJid\"] }}",
              "type": "string"
            },
            {
              "id": "a019046c-3b5a-4fd0-a497-de55cb2178ea",
              "name": "meta.telefoneEmpresa",
              "value": "={{ $json.body.sender }}",
              "type": "string"
            },
            {
              "id": "dab7ca54-c3d2-4a36-a9ca-a0ebbd375ef5",
              "name": "meta.nomeCliente",
              "value": "={{ $json.body.data.pushName }}",
              "type": "string"
            },
            {
              "id": "01238a36-6907-4aec-ab21-26345ed5fc96",
              "name": "whatsapp.evo.nomeInstancia",
              "value": "={{ $json.body.instance || null }}",
              "type": "string"
            },
            {
              "id": "81612acf-1b66-4c8e-82e4-ce8c77b31334",
              "name": "content.mensagem",
              "value": "={{ \n  $json.body?.content || \n\n  $json.body?.data?.message?.extendedTextMessage?.text || \n  $json.body?.data?.message?.imageMessage?.caption || \n  $json.body?.data?.message?.conversation || \n  $json?.message?.text || \n  $json?.message?.caption || \n  null \n}}",
              "type": "string"
            },
            {
              "id": "cc7dcfe1-8ad7-4fe8-93ec-8f643c7d08c7",
              "name": "content.tipoMensagem",
              "value": "={{ $json.body.data.messageType }}",
              "type": "string"
            },
            {
              "id": "2dfc64f4-b222-4ea7-b095-fdd96d9fcb95",
              "name": "content.idMensagem",
              "value": "={{ $json.body.data.key.id }}",
              "type": "string"
            },
            {
              "id": "9d947263-3b68-4c63-88ba-ef1b9de22571",
              "name": "empresa.nomeEmpresa",
              "value": "Sorveteiro Raiz",
              "type": "string"
            },
            {
              "id": "076ad2d4-b8ea-440f-9c02-f7e8417a984d",
              "name": "whatsapp.evo.apikey",
              "value": "={{ $json.body.apikey || null }}",
              "type": "string"
            },
            {
              "id": "0c237725-0428-4f1d-bddf-41bd289b3168",
              "name": "whatsapp.evo.server_url",
              "value": "={{ $json.body.server_url || null }}",
              "type": "string"
            },
            {
              "id": "255b9c45-7769-4d09-9c50-61dcdfb7c09d",
              "name": "app.debouncerTime",
              "value": "20",
              "type": "string"
            },
            {
              "id": "fc7c5c8f-b505-4a43-ae07-51eea58d6f80",
              "name": "linkPreview",
              "value": false,
              "type": "boolean"
            },
            {
              "id": "e30bbf8c-d5da-4410-b875-8dfe4b301798",
              "name": "Digitando",
              "value": 6400,
              "type": "number"
            },
            {
              "id": "c4f557bd-72f1-4507-8d9d-c2a590eea2b8",
              "name": "content.quoted",
              "value": "={{ $json.body.data.message.conversation }}\n{{ $json.body.data.message.imageMessage.url }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "317e3f32-4f43-44dc-9895-313081de22c7",
      "name": "camposIniciais",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3880,
        1660
      ],
      "notesInFlow": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "b7158aa0-84e0-44b1-8629-bf23fb4c0766",
              "name": "=messages",
              "value": "={{ $item(\"0\").$node[\"UserMessage\"].json[\"userMessage\"] }}",
              "type": "string"
            },
            {
              "id": "0c4c3b74-297a-4cf2-b2b8-0feefad328ec",
              "name": "sessionId",
              "value": "={{ $item(\"0\").$node[\"getClient\"].json[\"sessionid\"] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "a09d3e64-5b6c-4c8c-a3f4-1e96c9a7baff",
      "name": "messages",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        600,
        1620
      ]
    },
    {
      "parameters": {
        "content": "## PASSO 3 - DEFINE O TIPO DE MENSAGEM E ORGANIZA PARA O AGENTE",
        "height": 954,
        "width": 2019,
        "color": 6
      },
      "id": "0785dd62-4455-407a-a372-e723b93c7c61",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1260,
        1200
      ]
    },
    {
      "parameters": {
        "content": "### - Recebe dados da Evolution API [Webhook]\n\n### - Tratamento e Organização dos dados [camposIniciais]\n\n### - Combinar dados recebidos [unificaDados]",
        "width": 660,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4040,
        1420
      ],
      "typeVersion": 1,
      "id": "63da541e-93ef-4855-b50c-ecf6e859a6ef",
      "name": "Sticky Note20"
    },
    {
      "parameters": {
        "content": "\n\n## SISTEMA RAG REANKER",
        "height": 820,
        "width": 1040,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1100,
        1680
      ],
      "typeVersion": 1,
      "id": "997c47bf-1d0e-46e0-b57f-1b39acc823b2",
      "name": "Sticky Note24"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ (() => {\n  const mensagens = $('messages').all()[0].json.messages;\n  const contextoAnterior = $node[\"getContexto\"].json?.mensagem || '';\n  return contextoAnterior ? `${contextoAnterior}\\n\\n${mensagens}` : mensagens;\n})() }}",
        "options": {
          "systemMessage": "={{ $('Prompt_').first().json.systemMessageAgente }}"
        }
      },
      "id": "a3a124e9-5f53-4fd6-b4f3-ba346c143308",
      "name": "Vendedor IA",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        1440,
        1460
      ]
    },
    {
      "parameters": {
        "content": "### - Verifica se já existe um cliente cadastrado\n\n### - Se sim, prossegue o fluxo\n\n### - Se não, cria um cliente e um id do chat e prossegue o fluxo",
        "width": 660,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2420,
        1300
      ],
      "typeVersion": 1,
      "id": "508823b6-5ea4-460d-a07d-5b15e6e264e7",
      "name": "Sticky Note27"
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        -560,
        1320
      ],
      "id": "a707ac4e-9862-46f7-bd2c-a23d4c892092",
      "name": "transcreve audio2",
      "credentials": {
        "openAiApi": {
          "id": "0rHN6jIsNaCtzboq",
          "name": "AI Vendas | Dani 3 - Evo + N8N"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Extrai os números dos campos telefoneCliente e telefoneEmpresa removendo \"@s.whatsapp.net\"\nreturn items.map(item => {\n  const clienteRaw = item.json.meta?.telefoneCliente || '';\n  const empresaRaw = item.json.meta?.telefoneEmpresa || '';\n\n  const telefoneCliente = clienteRaw.split('@')[0];\n  const telefoneEmpresa = empresaRaw.split('@')[0];\n\n  return {\n    json: {\n      telefoneCliente,\n      telefoneEmpresa\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3680,
        1660
      ],
      "id": "15515fb5-1e9c-4638-a446-c63ad08e0b90",
      "name": "Code"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "disparo_mensagem_ia_vendas",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "keyValue": "={{ $item(\"0\").$node[\"Code\"].json[\"telefoneCliente\"] }}"
            }
          ]
        }
      },
      "id": "03e17297-3432-4e04-8c23-20e3ad1877dd",
      "name": "getContexto",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -3200,
        1660
      ],
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "QiHN5zEBNyZ0P663",
          "name": "Supabase - Sorveteiro Raiz"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "disparo_mensagem_ia_vendas",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "condition": "eq",
              "keyValue": "={{ $item(\"0\").$node[\"Code\"].json[\"telefoneCliente\"] }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        3300,
        1280
      ],
      "id": "5ece92bb-d1f2-4565-85eb-ced915fcd7b8",
      "name": "Supabase",
      "credentials": {
        "supabaseApi": {
          "id": "QiHN5zEBNyZ0P663",
          "name": "Supabase - Sorveteiro Raiz"
        }
      }
    },
    {
      "parameters": {
        "action": "generate"
      },
      "id": "a68f9f31-dc98-4930-bff1-a8d5cf16e32a",
      "name": "GeraUUID",
      "type": "n8n-nodes-base.crypto",
      "typeVersion": 1,
      "position": [
        -2000,
        1820
      ],
      "notesInFlow": false
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "aa4d5d29-e6f1-4bce-b5ff-4575b553a077",
              "name": "systemMessageAgente",
              "value": "=<IAConfig>\n\n  <Segurança>\n    <Regra>⚠️ A IA NUNCA pode inventar, assumir ou chutar valores. Se não tiver certeza absoluta, NÃO RESPONDA.</Regra>\n    <Regra>⚠️ TODAS as informações relacionadas a nome do produto, descrição, diferenciais e detalhes devem ser obtidas EXCLUSIVAMENTE através da tool \"searchProduto\".</Regra>\n    <Regra>⚠️ As informações de preço, formas de pagamento e link de compra devem ser obtidas EXCLUSIVAMENTE pelos seguintes caminhos:</Regra>\n    <Regra>• Preço: {{ $node[\"Oferta\"].json[\"Preço\"] }}</Regra>\n    <Regra>• Formas de Pagamento: {{ $node[\"Oferta\"].json[\"Forma de Pagamento\"] }}</Regra>\n    <Regra>• Link de Compra: {{ $item(\"0\").$node[\"Oferta\"].json[\"Link\"] }}</Regra>\n    <Regra>⚠️ Nunca envie links sem o cliente pedir — *com exceção da situação abaixo*:</Regra>\n    <Regra>⚠️ ✅ SE o lead demonstrar QUALQUER interesse em comprar, você TEM AUTORIZAÇÃO TOTAL para enviar IMEDIATAMENTE o link de pagamento {{ $item(\"0\").$node[\"Oferta\"].json[\"Link\"] }}.</Regra>\n    <Regra>⚠️ Nunca se apresente se a mensagem de contexto ({{ $node[\"getContexto\"].json[\"mensagem\"] }}) estiver preenchida.</Regra>\n    <Regra>⚠️ NUNCA use CTAs fracos como: “Quer saber mais?”, “Fico à disposição”, “Tem alguma dúvida?”. Use sempre chamadas diretas para ação.</Regra>\n    <Regra>⚠️ Não trate o lead como comprador pronto. Vá conduzindo com perguntas estratégicas.</Regra>\n    <Regra>⚠️ Nunca deixe o lead escapar sem tentar contornar a objeção. NÃO aceite “vou pensar” como resposta final.</Regra>\n    <Regra>⚠️ Se não tiver contexto, tudo bem se apresentar. Mas se tiver contexto, pule a apresentação SEMPRE.</Regra>\n  </Segurança>\n\n  <ObjetivoFinal>Converter qualquer tipo de lead em VENDA.</ObjetivoFinal>\n\n  <Persona>\n    <Nome>Dani</Nome>\n    <Tom>direto, vendedor agressivo, estratégico, empático, provocativo</Tom>\n    <Evitar>fala robótica, emojis exagerados, palavras difíceis, formalidades, CTAs fracos</Evitar>\n    <Foco>venda, urgência, solução real, despertar necessidade</Foco>\n  </Persona>\n\n  <Produto>\n    <ConsultaViaTool>⚠️ Informações de nome, descrição, diferenciais e detalhes do produto devem ser buscadas sempre via \"searchProduto\".</ConsultaViaTool>\n    <ConsultaViaNode>⚠️ Preço: {{ $node[\"Oferta\"].json[\"Preço\"] }} | Formas de Pagamento: {{ $node[\"Oferta\"].json[\"Forma de Pagamento\"] }} | Link de Compra: {{ $item(\"0\").$node[\"Oferta\"].json[\"Link\"] }}</ConsultaViaNode>\n  </Produto>\n\n  <Pagamento>\n    <ConsultaViaNode>⚠️ Formas de pagamento e preço sempre pelos caminhos indicados no node \"Oferta\".</ConsultaViaNode>\n  </Pagamento>\n\n  <Condicionais>\n    <Se test=\"lead.menciona('preço', 'valor')\">\n      <Se test=\"contexto.contem('já enviei informações do curso')\">\n        <Acao texto=\"O valor do curso é {{ $node['Oferta'].json['Preço'] }}. Pode pagar via {{ $node['Oferta'].json['Forma de Pagamento'] }}. Se quiser garantir sua vaga agora, é só acessar: {{ $item('0').$node['Oferta'].json['Link'] }}\" />\n      </Se>\n      <Se test=\"!contexto.contem('já enviei informações do curso')\">\n        <Acao texto=\"Te explico sim! Mas antes, posso te mostrar o que esse curso entrega? É isso que justifica o investimento.\" />\n        <Acao tool=\"searchProduto\" finalidade=\"consultar informações detalhadas do produto\" />\n        <Acao texto=\"O valor do curso é {{ $node['Oferta'].json['Preço'] }}. Pode pagar via {{ $node['Oferta'].json['Forma de Pagamento'] }}. Se quiser garantir sua vaga agora, é só acessar: {{ $item('0').$node['Oferta'].json['Link'] }}\" />\n      </Se>\n    </Se>\n\n    <Se test=\"lead.menciona('tempo', 'correria')\">\n      <Acao texto=\"Pode ficar tranquilo. Você tem acesso por 1 ano e estuda no seu ritmo.\" />\n    </Se>\n\n    <Se test=\"lead.menciona('máquina', 'vou começar')\">\n      <Acao texto=\"Você tá no momento ideal. Dá pra começar até com batedeira planetária nos testes.\" />\n    </Se>\n\n    <Se test=\"lead.menciona('comprar', 'fechar', 'pagar', 'adquirir', 'quero', 'me manda o link')\">\n      <Acao texto=\"Perfeito! Aqui está o link de pagamento direto: {{ $item('0').$node['Oferta'].json['Link'] }}\" />\n    </Se>\n\n    <Se test=\"lead.menciona('o que tem no curso', 'me fala do curso', 'o que oferece')\">\n      <Acao tool=\"searchProduto\" finalidade=\"consultar informações detalhadas do produto\" />\n    </Se>\n  </Condicionais>\n\n  <Objeções>\n    <Item nome=\"Quero fazer sorvete apenas para consumo próprio. O curso é pra mim?\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n    <Item nome=\"Não tenho maquinários, posso fazer o curso?\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n    <Item nome=\"Faço geladinho gourmet. Isso serve pra mim?\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n    <Item nome=\"Já trabalho com sorvete/açaí, mas minhas receitas não ficam boas. O curso ajuda nisso?\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n    <Item nome=\"Tenho experiência, mas quero melhorar meus produtos.\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n    <Item nome=\"Tenho dificuldade com receitas e nunca consigo fazer uma nova do zero.\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n    <Item nome=\"Já sei fazer sorvete, quero só aprender a balancear.\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n    <Item nome=\"Quanto tempo tenho de acesso?\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n    <Item nome=\"O curso é atualizado?\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n    <Item nome=\"E se eu tiver dúvidas?\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n    <Item nome=\"Eu ainda não tenho nenhuma máquina, só queria testar com uma batedeira. Será que esse curso é pra mim?\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n    <Item nome=\"Na verdade, eu só queria aprender a fazer pra família, algo mais simples...\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n    <Item nome=\"Eu já tenho minha loja, mas minhas receitas ainda não ficam como eu gostaria.\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n    <Item nome=\"Eu já entendo de sorvete, preciso só aprender a balancear melhor ou ajustar detalhes.\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n    <Item nome=\"Eu faço geladinho gourmet, esse curso serve pra mim?\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n    <Item nome=\"Eu tô com medo de não conseguir aprender, parece muito técnico...\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n    <Item nome=\"No curso indica maquinário?\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n    <Item nome=\"No curso tem receitas?\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n    <Item nome=\"VOCÊS VENDEM SOMENTE A TABELA DE BALANCEAMENTO?\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n    <Item nome=\"NÃO TENHO DINHEIRO\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n    <Item nome=\"VOU DEIXAR PARA A PRÓXIMA\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n    <Item nome=\"Eu já produzo em escala, esse curso vai agregar mesmo?\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n    <Item nome=\"Não sei se vou conseguir acompanhar tudo, minha rotina é puxada.\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n    <Item nome=\"E se eu não gostar?\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n    <Item nome=\"Quais aulas tem no curso?\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"consultar detalhes da objeção\" />\n    </Item>\n  </Objeções>\n\n  <Fechamento>\n    <CTA>Quer garantir sua vaga agora com o desconto especial, ou tem só mais 1 dúvida antes de fechar?</CTA>\n    <MensagemFinal>Seja bem-vindo à Família Sorveteiro Raiz! Vamos te acompanhar nessa transformação.</MensagemFinal>\n  </Fechamento>\n\n  <ReforçoFinal>\n    <Regra>⚠️ Nunca invente informações de produto. Use sempre \"searchProduto\" para nome, descrição, diferenciais e detalhes.</Regra>\n    <Regra>⚠️ Preço, formas de pagamento e link de compra exclusivamente pelos caminhos do node \"Oferta\".</Regra>\n    <Regra>⚠️ Nunca se apresente se contexto estiver preenchido.</Regra>\n    <Regra>⚠️ Nunca use CTAs fracos no fim.</Regra>\n    <Regra>⚠️ Foque sempre na urgência, na dor do cliente e no valor da solução.</Regra>\n  </ReforçoFinal>\n\n</IAConfig>\n",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "c906c200-bba8-459d-9098-3a861ede4d59",
      "name": "Prompt_",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2800,
        1660
      ],
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ $item(\"0\").$node[\"camposIniciais\"].json[\"meta\"][\"telefoneCliente\"] }}"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        3500,
        1280
      ],
      "id": "291b7edf-7dda-47ff-ba19-773fbf1b76d2",
      "name": "Redis2",
      "credentials": {
        "redis": {
          "id": "WKYrbj8mpqYSkF5s",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -4040,
        1660
      ],
      "id": "66883f58-fb85-4055-a0e6-eb49ee87339d",
      "name": "Wait",
      "webhookId": "49ec0327-3222-4e51-becc-a9bd4eeb1a32",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "base64",
        "options": {}
      },
      "id": "987410f0-ef58-495d-8509-78c5745dc3e6",
      "name": "converte imagem",
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -620,
        1900
      ]
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "text": "=<image_analyzer>\n  <identity>\n    <name>analisador visual</name>\n    <persona>analista técnico e detalhista</persona>\n    <style>objetivo, claro e direto</style>\n  </identity>\n  \n  <behaviors>\n    <analysis_flow>\n      <step1>identificar elementos principais da imagem</step1>\n      <step2>descrever contexto e ambiente</step2>\n      <step3>notar detalhes relevantes</step3>\n    </analysis_flow>\n    \n    <donts>\n      <rule>nunca inventar elementos que não estão na imagem</rule>\n      <rule>nunca fazer suposições além do visível</rule>\n      <rule>nunca usar termos técnicos desnecessários</rule>\n      <rule>nunca ignorar elementos importantes</rule>\n     </rule>\n    </donts>\n    \n    <response_format>\n      <tone>profissional mas acessível</tone>\n      <structure>organizada e hierárquica</structure>\n      <detail_level>completo mas conciso</detail_level>\n    </response_format>\n  </behaviors>\n\n  </output_rules>\n</image_analyzer>",
        "inputType": "base64",
        "options": {}
      },
      "id": "77ba1842-4ae1-42d8-bd15-84963e629167",
      "name": "transcreve imagem",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.4,
      "position": [
        -460,
        1900
      ],
      "credentials": {
        "openAiApi": {
          "id": "QzQb6Q9G3hGozb9v",
          "name": "OpenAi - Dani 2"
        }
      }
    },
    {
      "parameters": {
        "amount": 10
      },
      "id": "6ee045a4-2da9-4f29-81e7-037e7275b76e",
      "name": "espera evolution processar imagem",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -960,
        1880
      ],
      "webhookId": "276b709f-7d4b-4233-9e69-254f25485c76",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('camposIniciais').item.json.meta.telefoneCliente.toString() }}",
        "messageData": "={{ $json.content }}",
        "tail": true
      },
      "id": "50bb4c43-9072-4c1d-9e4a-2649556670fe",
      "name": "empilhaÁudio1",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -260,
        1900
      ],
      "credentials": {
        "redis": {
          "id": "WKYrbj8mpqYSkF5s",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('camposIniciais').item.json.whatsapp.evo.server_url }}/chat/getBase64FromMediaMessage/{{ $item(\"0\").$node[\"camposIniciais\"].json[\"whatsapp\"][\"evo\"][\"nomeInstancia\"] }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $item(\"0\").$node[\"camposIniciais\"].json[\"whatsapp\"][\"evo\"][\"apikey\"] }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n    \"message\": {\n        \"key\": {\n            \"id\": \"{{ $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"data\"][\"key\"][\"id\"] }}\"\n        }\n    },\n    \"convertToMp4\": false\n}",
        "options": {}
      },
      "id": "5c96f1fd-2804-4ad6-8116-f6179c0da1b5",
      "name": "Busca imagem",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -820,
        1880
      ]
    },
    {
      "parameters": {
        "model": "text-embedding-3-large",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1800,
        1940
      ],
      "id": "c133f971-b090-427b-ae1d-2f9845b8cca1",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "QzQb6Q9G3hGozb9v",
          "name": "OpenAi - Dani 2"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.rerankerCohere",
      "typeVersion": 1,
      "position": [
        2000,
        1940
      ],
      "id": "e110c629-abeb-4766-9ffa-25251895247c",
      "name": "Reranker Cohere",
      "credentials": {
        "cohereApi": {
          "id": "A7tX1jXD2d5wRh1M",
          "name": "CohereApi account"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Use essa tool para consultar informações sobre o produto \"Profissão Sorveteiro\"",
        "tableName": {
          "__rl": true,
          "value": "ps_produto",
          "mode": "list",
          "cachedResultName": "ps_produto"
        },
        "topK": 20,
        "useReranker": true,
        "options": {
          "queryName": "match_ps_produto"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        1800,
        1780
      ],
      "id": "e7c599e6-3f51-46a4-b00f-47cbdafc8c23",
      "name": "searchProduto",
      "credentials": {
        "supabaseApi": {
          "id": "QiHN5zEBNyZ0P663",
          "name": "Supabase - Sorveteiro Raiz"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0ad262f3-a7f6-4a86-a840-1dff931a959a",
              "name": "Preço",
              "value": "R$ 1.797,00",
              "type": "string"
            },
            {
              "id": "1178fd11-4d1d-4ff2-9ae2-431edfc5a409",
              "name": "Forma de Pagamento",
              "value": "Pix, Cartão de Crédito e Boleto Parcelado em até 12x",
              "type": "string"
            },
            {
              "id": "41b8d959-6639-463e-9c15-0a374a87cd2f",
              "name": "Link",
              "value": "https://lp.sorveteiroraiz.com/curso-profissao-sorveteiro-pg-ia-vendas",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3000,
        1660
      ],
      "id": "2caefa56-8d20-4e8f-8cfa-99dafb608c0c",
      "name": "Oferta"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('camposIniciais').item.json.whatsapp.evo.server_url }}/chat/getBase64FromMediaMessage/{{ $item(\"0\").$node[\"camposIniciais\"].json[\"whatsapp\"][\"evo\"][\"nomeInstancia\"] }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $item(\"0\").$node[\"camposIniciais\"].json[\"whatsapp\"][\"evo\"][\"apikey\"] }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n       \"message\": {\n        \"key\": {\n            \"id\": \"{{ $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"data\"][\"key\"][\"id\"] }}\"\n        }\n    },\n    \"convertToMp4\": true\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -960,
        1320
      ],
      "id": "99e84a90-5710-4423-a675-1b5106a565d1",
      "name": "Get Base64 Audio"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "base64",
        "options": {}
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -760,
        1320
      ],
      "id": "6db0518c-765a-4b86-8b29-0052255fee29",
      "name": "Get Audio"
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $item(\"0\").$node[\"camposIniciais\"].json[\"meta\"][\"telefoneCliente\"] }}",
        "messageData": "={{ $item(\"0\").$node[\"camposIniciais\"].json[\"content\"][\"mensagem\"] }}",
        "tail": true
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -960,
        1620
      ],
      "id": "3f349526-1b0b-4c0c-9a70-e003ea82f072",
      "name": "Add na Memória",
      "credentials": {
        "redis": {
          "id": "WKYrbj8mpqYSkF5s",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "amount": 15
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -560,
        1620
      ],
      "id": "c39be7e0-58c9-4db4-a8c1-20a73cea758e",
      "name": "Espere",
      "webhookId": "5efbac78-7c17-44b9-92cc-c3078c79f8d8"
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "Memória Inicial",
        "key": "={{ $item(\"0\").$node[\"camposIniciais\"].json[\"meta\"][\"telefoneCliente\"] }}",
        "options": {}
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -760,
        1620
      ],
      "id": "80afafc4-1bbf-440e-888c-3a864ad9de1b",
      "name": "Memória Inicial",
      "credentials": {
        "redis": {
          "id": "WKYrbj8mpqYSkF5s",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "Memória Final",
        "key": "={{ $item(\"0\").$node[\"camposIniciais\"].json[\"meta\"][\"telefoneCliente\"] }}",
        "options": {}
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -380,
        1620
      ],
      "id": "e538dd42-7ccc-456d-a598-d910856339da",
      "name": "Memória Final",
      "credentials": {
        "redis": {
          "id": "WKYrbj8mpqYSkF5s",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Acesse os arrays das variáveis\nconst memoriaInicialArray = $('Memória Inicial').all()[0].json['Memória Inicial'];\nconst memoriaFinalArray = $json['Memória Final'];\n\n// Verifique se as variáveis são arrays e junte os elementos em strings\nconst memoriaInicial = Array.isArray(memoriaInicialArray) ? memoriaInicialArray.join(' ') : '';\nconst memoriaFinal = Array.isArray(memoriaFinalArray) ? memoriaFinalArray.join(' ') : '';\n\n// Retorne as variáveis resultantes\nreturn {\n  memoriaInicial,\n  memoriaFinal\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -180,
        1620
      ],
      "id": "e3a5a2db-aaeb-45c6-abd6-d56902f2166a",
      "name": "Concatena Mensagens"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "fbe500bb-8a66-4f0c-93df-9631e3bdabfc",
              "leftValue": "={{ $('Concatena Mensagens').all()[0].json.memoriaInicial }}",
              "rightValue": "={{ $('Concatena Mensagens').all()[0].json.memoriaFinal }}",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        20,
        1620
      ],
      "id": "3ba2017c-38b8-48ba-a681-32ba1c7c2fa5",
      "name": "Compara Memórias"
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ $item(\"0\").$node[\"camposIniciais\"].json[\"meta\"][\"telefoneCliente\"] }}"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        220,
        1620
      ],
      "id": "774c442c-3878-4567-b374-d2559174c7bc",
      "name": "Limpar Memória",
      "credentials": {
        "redis": {
          "id": "WKYrbj8mpqYSkF5s",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $item(\"0\").$node[\"camposIniciais\"].json[\"meta\"][\"telefoneCliente\"] }}",
        "messageData": "={{ $json.text }}",
        "tail": true
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -380,
        1320
      ],
      "id": "46cfbe16-4c52-4abe-b733-63d675aed7d8",
      "name": "Add Áudio no Buffer",
      "credentials": {
        "redis": {
          "id": "WKYrbj8mpqYSkF5s",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "18e16067-bcdb-4bda-9c22-e1869c550af6",
              "name": "userMessage",
              "value": "={{ $('Compara Memórias').all()[0].json.memoriaFinal }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        400,
        1620
      ],
      "id": "39902610-095e-4a74-b1a5-846c147ddd68",
      "name": "UserMessage"
    },
    {
      "parameters": {
        "tableId": "follow_up",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "nome",
              "fieldValue": "={{ $('camposIniciais').item.json.meta.nomeCliente }}"
            },
            {
              "fieldId": "telefone",
              "fieldValue": "={{ $item(\"0\").$node[\"Code\"].json[\"telefoneCliente\"] }}"
            },
            {
              "fieldId": "ultima_mensagem",
              "fieldValue": "={{ $now }}"
            },
            {
              "fieldId": "sessionid",
              "fieldValue": "={{ $json.sessionid }}"
            }
          ]
        }
      },
      "id": "1e01a04e-8ecb-4a27-8b5d-589d2153bd83",
      "name": "Cria contato follow_up",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1660,
        1820
      ],
      "credentials": {
        "supabaseApi": {
          "id": "QiHN5zEBNyZ0P663",
          "name": "Supabase - Sorveteiro Raiz"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "follow_up",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "condition": "eq",
              "keyValue": "={{ $('Code').item.json.telefoneCliente }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "ultima_mensagem",
              "fieldValue": "={{ $now }}"
            }
          ]
        }
      },
      "id": "62a6efff-11c6-4553-86c7-77f478f66d07",
      "name": "Atualiza_follow_up",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1720,
        1620
      ],
      "credentials": {
        "supabaseApi": {
          "id": "QiHN5zEBNyZ0P663",
          "name": "Supabase - Sorveteiro Raiz"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "model": "text-embedding-3-large",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1500,
        2000
      ],
      "id": "ff35d0f0-27f4-464a-bcdc-b30af72c9122",
      "name": "Embeddings OpenAI1",
      "credentials": {
        "openAiApi": {
          "id": "QzQb6Q9G3hGozb9v",
          "name": "OpenAi - Dani 2"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.rerankerCohere",
      "typeVersion": 1,
      "position": [
        1640,
        2000
      ],
      "id": "622e16e7-d1db-49ac-b8e6-ec473c6824bb",
      "name": "Reranker Cohere1",
      "credentials": {
        "cohereApi": {
          "id": "A7tX1jXD2d5wRh1M",
          "name": "CohereApi account"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Use essa tool para consultar informações sobre o curso \"Profissão Sorveteiro\"",
        "tableName": {
          "__rl": true,
          "value": "ps_curso",
          "mode": "list",
          "cachedResultName": "ps_curso"
        },
        "topK": 20,
        "useReranker": true,
        "options": {
          "queryName": "match_ps_curso"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        1500,
        1780
      ],
      "id": "574633a7-f1a2-46d2-adb7-37415fdbf998",
      "name": "searchcurso",
      "credentials": {
        "supabaseApi": {
          "id": "QiHN5zEBNyZ0P663",
          "name": "Supabase - Sorveteiro Raiz"
        }
      }
    },
    {
      "parameters": {
        "model": "text-embedding-3-large",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1180,
        1960
      ],
      "id": "dd943f25-9397-4124-86fc-ab04b8f5b984",
      "name": "Embeddings OpenAI2",
      "credentials": {
        "openAiApi": {
          "id": "QzQb6Q9G3hGozb9v",
          "name": "OpenAi - Dani 2"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.rerankerCohere",
      "typeVersion": 1,
      "position": [
        1320,
        1960
      ],
      "id": "dd5445af-2b16-483b-ae78-6e716e0ad9a6",
      "name": "Reranker Cohere2",
      "credentials": {
        "cohereApi": {
          "id": "A7tX1jXD2d5wRh1M",
          "name": "CohereApi account"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Use essa tool para consultar informações sobre   objecoes para o Curso Profissão sorveteiro",
        "tableName": {
          "__rl": true,
          "value": "ps_objecoes",
          "mode": "list",
          "cachedResultName": "ps_objecoes"
        },
        "topK": 20,
        "useReranker": true,
        "options": {
          "queryName": "match_ps_objecoes"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        1180,
        1800
      ],
      "id": "c55776f1-61b6-40ee-bac4-ef0f4cebaefd",
      "name": "searchobjecoes",
      "credentials": {
        "supabaseApi": {
          "id": "QiHN5zEBNyZ0P663",
          "name": "Supabase - Sorveteiro Raiz"
        }
      }
    },
    {
      "parameters": {
        "model": "text-embedding-3-large",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1180,
        2320
      ],
      "id": "1f55d8d0-f98e-4f32-9d91-2ae4745ee113",
      "name": "Embeddings OpenAI3",
      "credentials": {
        "openAiApi": {
          "id": "QzQb6Q9G3hGozb9v",
          "name": "OpenAi - Dani 2"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.rerankerCohere",
      "typeVersion": 1,
      "position": [
        1380,
        2320
      ],
      "id": "d8986ce0-e858-4c34-9c10-0412d2dcc83d",
      "name": "Reranker Cohere3",
      "credentials": {
        "cohereApi": {
          "id": "A7tX1jXD2d5wRh1M",
          "name": "CohereApi account"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Use essa tool para consultar informações sobre o produto \"Profissão Sorveteiro\"",
        "tableName": {
          "__rl": true,
          "value": "ps_provasocial",
          "mode": "list",
          "cachedResultName": "ps_provasocial"
        },
        "topK": 20,
        "useReranker": true,
        "options": {
          "queryName": "match_ps_produto"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        1180,
        2160
      ],
      "id": "fbb61883-7d7a-4618-a992-42c968948fe2",
      "name": "searchprovasocial",
      "credentials": {
        "supabaseApi": {
          "id": "QiHN5zEBNyZ0P663",
          "name": "Supabase - Sorveteiro Raiz"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('messages').item.json.sessionId }}",
        "contextWindowLength": 25
      },
      "id": "90a10725-d312-4052-8397-e4a662233fc9",
      "name": "Memoria",
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.4,
      "position": [
        1600,
        1300
      ],
      "credentials": {
        "redis": {
          "id": "WKYrbj8mpqYSkF5s",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {}
      },
      "id": "b3915971-37ed-42e5-81c4-769e5f3d41db",
      "name": "Modelo IA",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        1440,
        1300
      ],
      "credentials": {
        "openAiApi": {
          "id": "QzQb6Q9G3hGozb9v",
          "name": "OpenAi - Dani 2"
        }
      }
    },
    {
      "parameters": {
        "amount": 3
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -1500,
        1820
      ],
      "id": "0f25133e-f331-446f-b309-69c9e6f8e5b7",
      "name": "Wait1",
      "webhookId": "ba2fcbee-aad3-4634-a1d3-ff161bc5abfd"
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ $item(\"0\").$node[\"camposIniciais\"].json[\"meta\"][\"telefoneCliente\"] }}"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -4660,
        2340
      ],
      "id": "469c00bb-9359-41fd-8bdf-695714aa120a",
      "name": "Limpar Memória1",
      "credentials": {
        "redis": {
          "id": "WKYrbj8mpqYSkF5s",
          "name": "Redis account"
        }
      }
    }
  ],
  "pinData": {
    "Webhook": [
      {
        "json": {
          "headers": {
            "host": "webhook.sorveteiroraiz.com",
            "user-agent": "axios/1.7.9",
            "content-length": "8012",
            "accept": "application/json, text/plain, */*",
            "accept-encoding": "gzip, compress, deflate, br",
            "content-type": "application/json",
            "x-forwarded-for": "172.18.0.1",
            "x-forwarded-host": "webhook.sorveteiroraiz.com",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "aae19483bb9a",
            "x-real-ip": "172.18.0.1"
          },
          "params": {},
          "query": {},
          "body": {
            "event": "messages.upsert",
            "instance": "IA - Vendas 01",
            "data": {
              "key": {
                "remoteJid": "5511984151865@s.whatsapp.net",
                "fromMe": false,
                "id": "3EB0D9DF5E36981C483CD1"
              },
              "pushName": "Higor Leite",
              "status": "DELIVERY_ACK",
              "message": {
                "imageMessage": {
                  "url": "https://mmg.whatsapp.net/o1/v/t24/f2/m239/AQPXlw5XHxZWg_yaw-jLnDWur8KQcFdAwpH1f9WNHeEdh0_ZYxMZuFJCedF67Huk6EE54NbRRLFf0ZvN0W_QYpSpH1h7vcsYgN-zICnbxA?ccb=9-4&oh=01_Q5Aa2AFntRf8IBpk6pMd-yF9mv6ER32in9Ij9_935Cp9tPGLPg&oe=6897A76B&_nc_sid=e6ed6c&mms3=true",
                  "mimetype": "image/jpeg",
                  "fileSha256": "S09FignspTr0ClF/CYVI1xNsKvzIDY5KJPHktOqnNbc=",
                  "fileLength": "41186",
                  "height": 523,
                  "width": 372,
                  "mediaKey": "nSlOnyE1yC4n6aLQ96HbXb7UJUaVNtZxG2jXhKO/CpQ=",
                  "fileEncSha256": "MLLxtLOo9IFoQRQ7k0fqp4hLAg7K35OQy0MXBT/j6Eg=",
                  "directPath": "/o1/v/t24/f2/m239/AQPy6js2-O_-diVyqops9okpkSdescMpB44Cv6NjCVVjraaHRsYyigufm6cQY4mrHlaGHRawB81hpnb4iA3uHmROMPX36oOBr9dfdSJDrw?ccb=9-4&oh=01_Q5Aa2AE-L_SFyVdo_ujKAYh9drbmg06Dnnv3ioQAv7z5pmObMw&oe=68A9FF67&_nc_sid=e6ed6c",
                  "mediaKeyTimestamp": "1752180741",
                  "jpegThumbnail": "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",
                  "viewOnce": false
                },
                "messageContextInfo": {
                  "deviceListMetadata": {
                    "senderKeyHash": "e1vKR32lUxcFiQ==",
                    "senderTimestamp": "1752350829",
                    "senderAccountType": "E2EE",
                    "receiverAccountType": "E2EE",
                    "recipientKeyHash": "HYcxukpAzWNTEw==",
                    "recipientTimestamp": "1752105579"
                  },
                  "deviceListMetadataVersion": 2,
                  "messageSecret": "YGgz5jCoNchwKts1IUTI8rfDFHapxMTvJIKyHIJGQuU="
                }
              },
              "contextInfo": null,
              "messageType": "imageMessage",
              "messageTimestamp": 1753381220,
              "instanceId": "6bf8734f-ee06-4a9e-bb0d-8b10dfe3975d",
              "source": "web",
              "chatwootMessageId": 334,
              "chatwootInboxId": 1,
              "chatwootConversationId": 5
            },
            "destination": "https://webhook.sorveteiroraiz.com/webhook/dani-aivendas-01",
            "date_time": "2025-07-24T15:20:22.671Z",
            "sender": "5512982655918@s.whatsapp.net",
            "server_url": "https://evolution.sorveteiroraiz.com",
            "apikey": "9B377004D560-405B-BCFC-62366342558C"
          },
          "webhookUrl": "https://webhook.sorveteiroraiz.com/webhook/dani-aivendas-01",
          "executionMode": "production"
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2025-06-12T04:31:09.302Z",
      "updatedAt": "2025-06-12T04:31:09.302Z",
      "id": "LNS3WObTA5Xk35NO",
      "name": "[IA VENDAS] [DANI]"
    },
    {
      "createdAt": "2025-06-14T17:42:47.387Z",
      "updatedAt": "2025-06-14T17:42:47.387Z",
      "id": "BUA0OcsQ75FU3GHE",
      "name": "[IA VENDAS] [DANI] [2]"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2025-08-04T18:39:53.934Z",
  "versionId": "d5151fb4-dc7e-4a20-88b1-c230c0ea00bd"
}